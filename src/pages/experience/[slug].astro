---
import Layout from '../../layouts/Layout.astro';
import type { CollectionEntry } from 'astro:content';
import { getCollection } from 'astro:content';

type ExperienceEntry = CollectionEntry<'experience'>;

export const getStaticPaths = async () => {
	const experiences = await getCollection('experience');
	return experiences.map((exp) => ({
		params: { slug: exp.slug },
		props: { exp },
	}));
};

const base = import.meta.env.BASE_URL;
const { exp } = Astro.props as { exp: ExperienceEntry };
const { Content } = await exp.render();

const start = new Intl.DateTimeFormat('en', { month: 'long', year: 'numeric' }).format(exp.data.startDate);
const endLabel = exp.data.endDate
	? new Intl.DateTimeFormat('en', { month: 'long', year: 'numeric' }).format(exp.data.endDate)
	: 'Present';
---

<Layout title={`${exp.data.role} @ ${exp.data.company}`} description={exp.data.summary}>
	<article class="container experience-detail">
	<a class="back-link" href={`${base}experience`}>&larr; Back to experience</a>
		<header class="experience-detail-header">
			<p class="experience-date">
				<span>{start}</span>
				<span class="dash">â€”</span>
				<span>{endLabel}</span>
			</p>
			<h1>
				{exp.data.role}
				<span>@ {exp.data.company}</span>
			</h1>
			{exp.data.location && <p class="experience-location">{exp.data.location}</p>}
			<p class="experience-summary">{exp.data.summary}</p>
			{exp.data.tags.length > 0 && (
				<ul class="experience-tags">
					{exp.data.tags.map((tag) => (
						<li>{tag}</li>
					))}
				</ul>
			)}
		</header>
		<section class="experience-body">
			<Content />
		</section>
	</article>
</Layout>

<style>
	.experience-detail {
		display: grid;
		gap: 2.5rem;
	}

	.experience-detail-header {
		background: rgba(10, 19, 45, 0.92);
		border-radius: 24px;
		border: 1px solid rgba(92, 114, 168, 0.26);
		box-shadow:
			0 24px 64px rgba(3, 8, 35, 0.45),
			inset 0 0 0 1px rgba(148, 163, 184, 0.14);
		padding: clamp(2rem, 4vw, 2.8rem);
		display: flex;
		flex-direction: column;
		gap: 1.1rem;
	}

	.experience-detail-header h1 {
		margin: 0;
		font-size: clamp(2rem, 4vw, 2.8rem);
		letter-spacing: -0.02em;
	}

	.experience-detail-header h1 span {
		display: block;
		font-size: clamp(1rem, 2vw, 1.2rem);
		color: var(--color-muted);
		letter-spacing: 0.06em;
		text-transform: uppercase;
	}

	.experience-body {
		background: rgba(5, 11, 29, 0.85);
		border-radius: 22px;
		border: 1px solid rgba(92, 114, 168, 0.18);
		padding: clamp(2rem, 4vw, 2.6rem);
		box-shadow: 0 18px 48px rgba(3, 8, 35, 0.4);
		line-height: 1.75;
	}

	.experience-body :global(h2) {
		font-size: 1.6rem;
		letter-spacing: -0.01em;
		margin-top: 2rem;
	}

	.experience-body :global(p),
	.experience-body :global(li) {
		color: var(--color-muted);
	}

	.experience-body :global(ul) {
		padding-left: 1.2rem;
	}

	@media (max-width: 720px) {
		.experience-detail-header,
		.experience-body {
			padding: 1.75rem;
		}
	}
</style>
