---
import Layout from '../layouts/Layout.astro';
import ProjectCard from '../components/ProjectCard.astro';
import BlogCard from '../components/BlogCard.astro';
import portrait from '../assets/kadhir-profile.png';
import { getCollection } from 'astro:content';

const projects = (await getCollection('projects'))
	.sort((a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf());
const featuredProjects = projects.filter((item) => item.data.featured).slice(0, 3);

const blogPosts = (await getCollection('blog'))
	.sort((a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf())
	.slice(0, 3);

const experiences = (await getCollection('experience')).sort(
	(a, b) => b.data.startDate.valueOf() - a.data.startDate.valueOf()
);

const heroSummary =
	"I've worked on everything from HV Battery Management Systems for Solar racecars to validating next-gen Ryzen CPUs at AMD. When I'm not tinkering with electronics, you'll find me powerlifiting, making keyboards, or exploring nature.";
const rotatingAdjectives = [
	{ article: 'an', word: 'engineer' },
	{ article: 'a', word: 'maker' },
	{ article: 'an', word: 'innovator' },
	{ article: 'a', word: 'problem solver' },
	{ article: 'a', word: 'student' },
];
const adjectivesJSON = JSON.stringify(rotatingAdjectives);
const skills = [
	'Python',
	'SolidWorks',
	'STM32',
	'Power Systems',
	'C/C++',
	'Zephyr RTOS',
	'KiCad',
	'Embedded Linux',
	'Lab Automation',
	'PCB Layout',
	'FPGA',
	'Data Visualization',
];
---

<Layout
	title="Kadhir Vivekanandan's Portfolio"
	description="just a chill guy documenting his chill projects and expereinces"
>
	<section class="hero" id="home">
		<div class="hero-scale">
			<div class="container hero-grid">
				<div class="hero-intro">
					<!-- <p class="hero-overline">Electronics & Systems Engineer</p> -->
					<h1 class="hero-title">
						<span class="hero-greeting">Hey, I'm</span>
						<span class="hero-name">Kadhir</span>
					</h1>
					<p class="hero-tagline">
						I'm <span class="hero-rotator" data-rotator>
							{`${rotatingAdjectives[0].article} ${rotatingAdjectives[0].word}`}
						</span>
					</p>
					<p class="hero-secondary">I make cool stuff. Check out my projects, experiences, and blog that I'll try to update frequently.</p>
					<p class="hero-summary">{heroSummary}</p>
					<div class="hero-actions">
						<a class="button primary" href="/projects">View projects</a>
						<a class="button secondary" href="/experience">Experience</a>
					</div>
				</div>
				<div class="hero-portrait">
					<figure class="portrait-frame">
						<img src={portrait.src} alt="Portrait of Kadhir" loading="lazy" decoding="async" />
					</figure>
					<div class="hero-socials">
						<a href="https://www.linkedin.com/in/kadhirvivekanandan" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
							<svg viewBox="0 0 24 24" role="img" aria-hidden="true">
								<path
									d="M4.98 3.5C4.98 4.88 3.87 6 2.5 6S0 4.88 0 3.5C0 2.12 1.12 1 2.5 1S4.98 2.12 4.98 3.5zM0 8h5v16H0zm8 0h4.79v2.6h.07c.67-1.2 2.3-2.47 4.73-2.47 5.06 0 5.99 3.33 5.99 7.66V24h-5v-7.6c0-1.81-.03-4.15-2.52-4.15-2.52 0-2.91 1.96-2.91 4V24H8z"
								/>
							</svg>
						</a>
						<a href="mailto:kadhir.vivek@gmail.com" target="_blank" rel="noopener noreferrer" aria-label="Email">
							<svg viewBox="0 0 24 24" role="img" aria-hidden="true">
								<path
									d="M2.4 4h19.2c1.33 0 2.4 1.07 2.4 2.4v11.2c0 1.33-1.07 2.4-2.4 2.4H2.4C1.07 20 0 18.93 0 17.6V6.4C0 5.07 1.07 4 2.4 4Zm0 2.4v.35l9.6 6.01 9.6-6.01v-.35H2.4Zm0 11.2h19.2v-8.1L12 15.33 2.4 9.5v8.1Z"
								/>
							</svg>
						</a>
						<a href="https://github.com/KadhirTheEngineer" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
							<svg viewBox="0 0 24 24" role="img" aria-hidden="true">
								<path
									d="M12 .5C5.65.5.5 5.65.5 12c0 5.09 3.29 9.4 7.86 10.93.58.1.79-.25.79-.56 0-.27-.01-1-.02-1.97-3.2.7-3.88-1.54-3.88-1.54-.53-1.35-1.28-1.71-1.28-1.71-1.05-.72.08-.71.08-.71 1.16.08 1.78 1.19 1.78 1.19 1.03 1.76 2.7 1.25 3.36.96.1-.75.4-1.25.72-1.54-2.55-.29-5.23-1.27-5.23-5.65 0-1.25.45-2.27 1.19-3.07-.12-.29-.52-1.45.11-3.02 0 0 .97-.31 3.18 1.17a10.9 10.9 0 0 1 5.8 0c2.2-1.48 3.17-1.17 3.17-1.17.63 1.57.23 2.73.11 3.02.74.8 1.18 1.82 1.18 3.07 0 4.4-2.69 5.36-5.25 5.64.41.36.77 1.07.77 2.16 0 1.56-.01 2.82-.01 3.2 0 .31.21.67.8.55A10.52 10.52 0 0 0 23.5 12C23.5 5.65 18.35.5 12 .5Z"
								/>
							</svg>
						</a>
						<a href="https://www.youtube.com/@kadhirtheengineer" target="_blank" rel="noopener noreferrer" aria-label="YouTube">
							<svg viewBox="0 0 24 24" role="img" aria-hidden="true">
								<path
									d="M23.498 6.186a2.996 2.996 0 0 0-2.11-2.12C19.505 3.5 12 3.5 12 3.5s-7.505 0-9.388.566a2.996 2.996 0 0 0-2.11 2.12A31.2 31.2 0 0 0 .5 12a31.2 31.2 0 0 0 .002 5.814 2.996 2.996 0 0 0 2.11 2.12C4.495 20.5 12 20.5 12 20.5s7.505 0 9.388-.566a2.996 2.996 0 0 0 2.11-2.12A31.2 31.2 0 0 0 23.5 12a31.2 31.2 0 0 0-.002-5.814ZM9.75 15.02V8.98L15.5 12Z"
								/>
							</svg>
						</a>
					</div>
				</div>
			</div>
			<a class="scroll-indicator" href="#projects" aria-label="Scroll to projects">
				<span>Scroll</span>
				<svg viewBox="0 0 24 24" role="img" aria-hidden="true">
					<path d="M12 16.5L5 9.5l1.4-1.4L12 13.7l5.6-5.6L19 9.5z" />
				</svg>
			</a>
		</div>
	</section>
	<section class="skills-section" aria-label="toolbox">
		<div class="container">
			<div class="skills-heading">
				<span>What I do</span>
				<div class="skills-divider"></div>
			</div>
			<div class="skills-marquee">
				<div class="skills-track" role="list">
					{[0, 1].map((loopIndex) => (
						<div class="skills-loop" aria-hidden={loopIndex === 1}>
							{skills.map((skill) => (
								<span class="skill-pill" role="listitem">
									{skill}
								</span>
							))}
						</div>
					))}
				</div>
			</div>
		</div>
	</section>

	<section id="projects" class="container">
		<div class="section-heading">
			<h2>Projects</h2>
			<span>Selected Work</span>
		</div>
		<div class="grid">
			{(featuredProjects.length ? featuredProjects : projects.slice(0, 3)).map((project) => (
				<ProjectCard entry={project} />
			))}
		</div>
		{projects.length > 3 && (
			<p style="margin-top: 1.5rem;">
				<a class="button secondary" href="/projects">Browse all projects</a>
			</p>
		)}
	</section>

	<section id="blog" class="container">
		<div class="section-heading">
			<h2>Blog</h2>
			<span>Notes &amp; Learnings</span>
		</div>
		{blogPosts.length ? (
			<div class="grid">
				{blogPosts.map((post) => (
					<BlogCard entry={post} />
				))}
			</div>
		) : (
			<p>No posts yet. Add one in <code>src/content/blog</code>.</p>
		)}
	</section>

	<section id="experience" class="container experience-section">
		<div class="section-heading">
			<h2>Experience</h2>
			<span>Journey So Far</span>
		</div>
		<div class="experience-timeline">
			<div class="experience-line" aria-hidden="true"></div>
			{experiences.map((exp, index) => {
				const position = index % 2 === 0 ? 'left' : 'right';
				const start = new Intl.DateTimeFormat('en', { month: 'short', year: 'numeric' }).format(
					exp.data.startDate
				);
				const endLabel = exp.data.endDate
					? new Intl.DateTimeFormat('en', { month: 'short', year: 'numeric' }).format(exp.data.endDate)
					: 'Present';
				return (
					<article class={`experience-item ${position}`}>
						<div class="experience-dot" aria-hidden="true"></div>
						<a class="experience-card" href={`/experience/${exp.slug}`}>
							<header>
								<p class="experience-date">
									<span>{start}</span>
									<span class="dash">—</span>
									<span>{endLabel}</span>
								</p>
								<h3>
									{exp.data.role}
									<span class="experience-company">@ {exp.data.company}</span>
								</h3>
								{exp.data.location && <p class="experience-location">{exp.data.location}</p>}
							</header>
							<p class="experience-summary">{exp.data.summary}</p>
							{exp.data.tags.length > 0 && (
								<ul class="experience-tags">
									{exp.data.tags.map((tag) => (
										<li>{tag}</li>
									))}
								</ul>
							)}
						</a>
					</article>
				);
			})}
		</div>
		<p class="experience-cta">
			Want the full story? <a href="/experience">Browse the complete experience timeline →</a>
		</p>
	</section>
	<script type="module" data-words={adjectivesJSON}>
		const initHero = () => {
			const script = document.querySelector('script[data-words]');
			const adjectives = JSON.parse(script?.dataset.words ?? '[]');
			const rotator = document.querySelector('[data-rotator]');

			if (!rotator || adjectives.length <= 1) {
				return;
			}

			let index = 0;
			let timer;

			const tick = () => {
				rotator.classList.add('is-changing');
				window.setTimeout(() => {
					index = (index + 1) % adjectives.length;
					const next = adjectives[index];
					rotator.textContent = `${next.article} ${next.word}`;
					rotator.classList.remove('is-changing');
				}, 220);
			};

			const current = adjectives[0];
			rotator.textContent = `${current.article} ${current.word}`;
			timer = window.setInterval(tick, 2600);

			document.addEventListener('visibilitychange', () => {
				if (document.hidden && timer) {
					window.clearInterval(timer);
					timer = undefined;
				} else if (!document.hidden && !timer) {
					timer = window.setInterval(tick, 2600);
				}
			});
		};

		if (document.readyState === 'loading') {
			document.addEventListener('DOMContentLoaded', initHero, { once: true });
		} else {
			initHero();
		}
	</script>
</Layout>
