---
import Layout from '../../layouts/Layout.astro';
import type { CollectionEntry } from 'astro:content';
import { getCollection } from 'astro:content';

type ProjectEntry = CollectionEntry<'projects'>;

export const getStaticPaths = async () => {
	const projects = await getCollection('projects');
	return projects.map((project) => ({
		params: { slug: project.slug },
		props: { project },
	}));
};

const { project } = Astro.props as { project: ProjectEntry };
const { Content } = await project.render();

const { title, description, publishedAt, tech = [], links, previewImage, previewImageAlt } = project.data;
const formattedDate = new Intl.DateTimeFormat('en', {
	month: 'long',
	day: 'numeric',
	year: 'numeric',
}).format(publishedAt);
const previewAlt = previewImageAlt ?? `${title} preview image`;
---

<Layout title={`${title} | Projects`} description={description}>
	<article class="container project-detail">
		<a class="back-link" href="/projects">&larr; Back to projects</a>
		<header>
			<h1>{title}</h1>
			<p class="project-description">{description}</p>
			{previewImage && (
				<figure class="project-preview">
					<img
						src={previewImage.src}
						width={previewImage.width}
						height={previewImage.height}
						alt={previewAlt}
						loading="lazy"
						decoding="async"
					/>
				</figure>
			)}
			<div class="meta">
				<span>{formattedDate}</span>
				{tech.length > 0 && (
					<div class="tag-list">
						{tech.map((item) => (
							<span class="tag">{item}</span>
						))}
					</div>
				)}
			</div>
			{links && (
				<div class="project-actions">
					{links.live && (
						<a class="button primary" href={links.live} target="_blank" rel="noopener noreferrer">
							View deployment
						</a>
					)}
					{links.source && (
						<a class="button secondary" href={links.source} target="_blank" rel="noopener noreferrer">
							Source code
						</a>
					)}
				</div>
			)}
		</header>
		<section class="project-body">
			<Content />
		</section>
	</article>
</Layout>

<style>
	.project-detail {
		display: grid;
		gap: 2.25rem;
	}

	.project-detail header {
		display: flex;
		flex-direction: column;
		gap: 1rem;
		padding: 2.25rem;
		background: var(--color-card);
		border-radius: var(--radius-lg);
		border: 1px solid rgba(148, 163, 184, 0.16);
		box-shadow: var(--shadow-lg);
	}

	.project-detail h1 {
		margin: 0;
		font-size: clamp(2.1rem, 4vw, 3rem);
		letter-spacing: -0.02em;
	}

	.project-description {
		margin: 0;
		color: var(--color-muted);
		max-width: 75ch;
	}

	.project-preview {
		margin: 0;
		border-radius: var(--radius-md);
		overflow: hidden;
		box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.02);
		border: 1px solid rgba(148, 163, 184, 0.15);
		background: rgba(8, 14, 35, 0.9);
	}

	.project-preview img {
		display: block;
		width: 100%;
		height: auto;
		object-fit: cover;
	}

	.project-actions {
		display: flex;
		flex-wrap: wrap;
		gap: 1rem;
		margin-top: 0.5rem;
	}

	.project-body {
		padding: 2.25rem;
		background: rgba(15, 23, 42, 0.82);
		border-radius: var(--radius-lg);
		border: 1px solid rgba(148, 163, 184, 0.14);
		box-shadow: var(--shadow-md);
		line-height: 1.7;
	}

	.project-body :global(.video-embed) {
		position: relative;
		width: 100%;
		padding-bottom: 56.25%;
		margin: 1.5rem 0;
		border-radius: var(--radius-md);
		overflow: hidden;
		background: rgba(8, 14, 35, 0.9);
		border: 1px solid rgba(148, 163, 184, 0.2);
		box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.02);
	}

	.project-body :global(.video-embed iframe) {
		position: absolute;
		inset: 0;
		width: 100%;
		height: 100%;
		border: 0;
	}

	.project-body :global(img) {
		display: block;
		width: 100%;
		height: auto;
		margin: 1.25rem 0;
		border-radius: var(--radius-md);
		box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.02);
		border: 1px solid rgba(148, 163, 184, 0.18);
		background: rgba(8, 14, 35, 0.9);
	}

	.project-body :global(h2) {
		font-size: 1.6rem;
		margin-top: 1.8rem;
		letter-spacing: -0.01em;
	}

	.project-body :global(p),
	.project-body :global(li) {
		color: var(--color-muted);
	}

	.project-body :global(ul) {
		padding-left: 1.2rem;
	}

	.back-link {
		color: var(--color-muted);
		font-size: 0.85rem;
		text-transform: uppercase;
		letter-spacing: 0.16em;
		display: inline-block;
		margin-bottom: -1rem;
		position: sticky;
		top: 5.5rem;
	}

	.back-link:hover,
	.back-link:focus-visible {
		color: var(--color-accent);
	}

	@media (max-width: 720px) {
		.project-detail header,
		.project-body {
			padding: 1.75rem;
		}

		.back-link {
			position: static;
			margin-bottom: 0;
		}
	}
</style>
